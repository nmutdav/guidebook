<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The TDAV Guidebook</title>
    <link rel="stylesheet" href="{{ '/assets/css/styles.css' | relative_url }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
</head>
<body>
    <header class="header-desktop">
        <div class="logo-title">
            <img src="{{ '/assets/images/icon.png' | relative_url }}" alt="Site Icon" class="site-icon">
            <h1><a href="{{ '/' | absolute_url }}">The TDAV Guidebook</a></h1>
        </div>
        <nav class="nav-menu">
            <a href="{{ '/wikindex' | absolute_url }}" class="nav-button">Back to Index</a>
        </nav>        
            <!-- Search Input -->
            <div class="search-container">
                <input type="text" id="search-box" placeholder="Search the Guidebook..." onkeyup="searchIndex()">
                <div id="search-results" class="search-results"></div>
            </div>
        </nav>  
    </header>

    <script>
        let idx;
        let data;

        // Fetch the JSON file and build the Lunr index
        fetch('{{ '/search.json' | relative_url }}')
            .then(response => response.json())
            .then(searchData => {
                data = searchData;
                idx = lunr(function () {
                    this.field('title');
                    this.field('content');
                    this.ref('url');

                    searchData.forEach(function (doc) {
                        this.add(doc);
                    }, this);
                });
            })
            .catch(error => console.error('Error fetching search data:', error));

        // Search function
        function searchIndex() {
            const query = document.getElementById('search-box').value.trim();
            const resultDiv = document.getElementById('search-results');
            resultDiv.innerHTML = ''; // Clear previous results

            if (query === '') return; // Exit if query is empty

            const results = idx.search(query);

            if (results.length === 0) {
                resultDiv.innerHTML = '<div class="no-results">No results found</div>';
                return;
            }

            results.forEach(function (result) {
                const item = data.find(page => page.url === result.ref);
                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item');
                resultItem.innerHTML = `
                    <a href="${item.url}">
                        <strong>${item.title}</strong><br>
                        <span>${item.content.substring(0, 100)}...</span>
                    </a>`;
                resultDiv.appendChild(resultItem);
            });
        }
    </script>

    <style>
        .search-container {
            position: relative;
        }

        #search-box {
            padding: 8px;
            width: 250px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }

        .search-results {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            max-height: 300px;
            overflow-y: auto;
            width: 250px;
            z-index: 1000;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 2px;
        }

        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .result-item:hover {
            background-color: #f0f0f0;
        }

        .result-item a {
            text-decoration: none;
            color: #333;
        }

        .result-item a:hover {
            text-decoration: underline;
        }

        .result-item strong {
            font-size: 14px;
            color: #007BFF;
        }

        .result-item span {
            display: block;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .no-results {
            padding: 10px;
            color: #666;
            text-align: center;
        }
    </style>
</body>
</html>
